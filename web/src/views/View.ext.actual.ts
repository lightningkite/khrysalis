// Generated by Khrysalis TypeScript converter
// File: views/View.ext.actual.kt
// Package: com.lightningkite.khrysalis.views

//! Declares com.lightningkite.khrysalis.views.onClick>android.view.View
export function androidViewViewOnClick(this_: HTMLElement, disabledMilliseconds: number = 500, action: () => void): void {
    let lastActivated = Date.now();

    this_.onclick = (_ev) => {
        _ev.stopPropagation();
        const it = _ev.target as HTMLElement;
        if (Date.now() - lastActivated > disabledMilliseconds) {
            action();
            lastActivated = Date.now();
        }
    };
}

//! Declares com.lightningkite.khrysalis.views.onLongClick>android.view.View
export function androidViewViewOnLongClick(this_: HTMLElement, action: () => void): void {
    this_.oncontextmenu = (_ev) => {
        _ev.stopPropagation();
        const it = _ev.target as HTMLElement;
        action();
    };
}

export function getViewVisibility(this_: HTMLElement): string {
    if (this_.hidden) return "gone";
    if (this_.style.visibility === "hidden") return "invisible";
    return "visible";
}

export function setViewVisibility(this_: HTMLElement, value: string) {
    switch (value) {
        case "gone":
            this_.hidden = true;
            this_.style.visibility = "visible";
            break;
        case "visible":
            this_.hidden = false;
            this_.style.visibility = "visible";
            break;
        case "invisible":
            this_.hidden = false;
            this_.style.visibility = "hidden";
            break;
    }
    const p = this_.parentElement;
    if(p && p.classList.contains("khrysalis-box")) {
        setViewVisibility(p, value);
    }
}

export function findView(view: HTMLElement, predicate: (e: HTMLElement) => boolean): HTMLElement | null {
    for (let i = 0; i < view.children.length; i++) {
        const child = view.children.item(i);
        if (child instanceof HTMLElement && predicate(child)) {
            return child;
        }
    }
    return null;
}

const backgroundClassSymbol = Symbol("backgroundCssClass");
declare global {
    interface HTMLElement {
        [backgroundClassSymbol]: string | undefined
    }
}
export function setViewBackgroundClass(view: HTMLElement, cssClass: string) {
    const existing = view[backgroundClassSymbol];
    if(existing){
        view.classList.remove(existing);
    }
    view[backgroundClassSymbol] = cssClass;
    view.classList.add(cssClass);
}