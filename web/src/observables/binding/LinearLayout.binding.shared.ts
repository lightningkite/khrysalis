// Generated by Khrysalis TypeScript converter - this file will be overwritten.
// File: observables/binding/LinearLayout.binding.shared.kt
// Package: com.lightningkite.khrysalis.observables.binding
// FQImport: com.lightningkite.khrysalis.observables.binding.bind.<anonymous>.excessViews TS excessViews
// FQImport: com.lightningkite.khrysalis.observables.binding.bind.<anonymous>.view TS view
// FQImport: com.lightningkite.khrysalis.observables.binding.bind.data TS data
// FQImport: com.lightningkite.khrysalis.observables.subscribeBy>com.lightningkite.khrysalis.observables.ObservableProperty<kotlin.Any> TS comLightningkiteKhrysalisObservablesObservablePropertySubscribeBy
// FQImport: com.lightningkite.khrysalis.observables.binding.bind.existingViews TS existingViews
// FQImport: com.lightningkite.khrysalis.observables.binding.LinearLayoutBoundSubview.view TS view
// FQImport: com.lightningkite.khrysalis.observables.binding.bind.<anonymous>.old TS old
// FQImport: com.lightningkite.khrysalis.rx.until>io.reactivex.disposables.Disposable TS ioReactivexDisposablesDisposableUntil
// FQImport: android.widget.LinearLayout.removeView TS removeView
// FQImport: com.lightningkite.khrysalis.observables.binding.bind.defaultValue TS defaultValue
// FQImport: com.lightningkite.khrysalis.observables.binding.bind.T TS T
// FQImport: com.lightningkite.khrysalis.views.geometry.AlignPair TS AlignPair
// FQImport: com.lightningkite.khrysalis.observables.binding.LinearLayoutBoundSubview.property TS property
// FQImport: com.lightningkite.khrysalis.observables.binding.LinearLayoutBoundSubview SKIPPED due to same file
// FQImport: com.lightningkite.khrysalis.observables.binding.bind.<anonymous>.value TS value
// FQImport: kotlin.collections.indices>kotlin.collections.Collection<kotlin.Any> TS getKotlinCollectionsCollectionIndices
// FQImport: com.lightningkite.khrysalis.observables.binding.bind.makeView TS makeView
// FQImport: com.lightningkite.khrysalis.observables.ObservableProperty TS ObservableProperty
// FQImport: com.lightningkite.khrysalis.observables.binding.bind.<anonymous>.prop TS prop
// FQImport: com.lightningkite.khrysalis.observables.binding.LinearLayoutBoundSubview TS LinearLayoutBoundSubview
// FQImport: com.lightningkite.khrysalis.observables.StandardObservableProperty TS StandardObservableProperty
// FQImport: com.lightningkite.khrysalis.rx.removed>android.view.View TS getAndroidViewViewRemoved
// FQImport: com.lightningkite.khrysalis.observables.binding.LinearLayoutBoundSubview.T TS T
// FQImport: com.lightningkite.khrysalis.views.geometry.AlignPair.Companion.centerFill TS centerFill
// FQImport: com.lightningkite.khrysalis.observables.StandardObservableProperty.value TS value
// FQImport: com.lightningkite.khrysalis.observables.binding.bind.<anonymous>.index TS index
// FQImport: com.lightningkite.khrysalis.views.params>android.widget.LinearLayout TS androidWidgetLinearLayoutParams
import { comLightningkiteKhrysalisObservablesObservablePropertySubscribeBy } from './../ObservableProperty.ext.shared'
import { getAndroidViewViewRemoved, ioReactivexDisposablesDisposableUntil } from './../../rx/DisposeCondition.actual'
import { androidWidgetLinearLayoutParams } from './../../views/LinearLayout.actual'
import { StandardObservableProperty } from './../StandardObservableProperty.shared'
import { ObservableProperty } from './../ObservableProperty.shared'
import { AlignPair } from './../../views/geometry/Align.shared'
import { NumberRange } from 'Kotlin'

//! Declares com.lightningkite.khrysalis.observables.binding.LinearLayoutBoundSubview
class LinearLayoutBoundSubview<T> {
    public readonly view: HTMLElement;
    public readonly property: StandardObservableProperty<T>;
    public constructor(view: HTMLElement, property: StandardObservableProperty<T>) {
        this.view = view;
        this.property = property;
    }
}

//! Declares com.lightningkite.khrysalis.observables.binding.bind>android.widget.LinearLayout
export function androidWidgetLinearLayoutBind<T>(this_: HTMLDivElement, data: ObservableProperty<Array<T>>, defaultValue: T, makeView:  (a: ObservableProperty<T>) => HTMLElement): void {
    const existingViews: Array<LinearLayoutBoundSubview<T>> = [];
    
    ioReactivexDisposablesDisposableUntil(comLightningkiteKhrysalisObservablesObservablePropertySubscribeBy(data, undefined, undefined, (value) => {
                //Fix view count
                const excessViews = existingViews.length - value.length;
                
                if (excessViews > 0) {
                    //remove views
                    for (const iter of new NumberRange(1, excessViews)) {
                        const old = existingViews.splice((existingViews.length - 1), 1);
                        
                        this_.removeView(old.view);
                    }
                } else if (existingViews.length < value.length) {
                    //add views
                    for (const iter of new NumberRange(1, (-excessViews))) {
                        const prop = new StandardObservableProperty(defaultValue, undefined);
                        
                        const view = makeView(prop);
                        
                        this_.appendChild(androidWidgetLinearLayoutParams(this_, undefined, undefined, undefined, undefined, undefined, undefined, AlignPair.Companion.INSTANCE.centerFill, undefined)(view));
                        existingViews.push(new LinearLayoutBoundSubview(view, prop));
                    }
                }
                
                //Update views
                for (const index of getKotlinCollectionsCollectionIndices(value)) {
                    existingViews[index].property.value = value[index];
                }
    }), getAndroidViewViewRemoved(this_));
}


