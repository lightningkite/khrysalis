// Generated by Khrysalis TypeScript converter
// File: observables/binding/Spinner.binding.actual.kt
// Package: com.lightningkite.khrysalis.observables.binding
import {comLightningkiteKhrysalisObservablesObservablePropertySubscribeBy as subBy} from '../ObservableProperty.ext.shared'
import {
    getAndroidViewViewRemoved as vRemoved,
    ioReactivexDisposablesDisposableUntil as until
} from '../../rx/DisposeCondition.actual'
import {ObservableProperty} from '../ObservableProperty.shared'
import {StandardObservableProperty} from '../StandardObservableProperty.shared'
import {IllegalStateException, tryCastClass} from 'Kotlin'
import {MutableObservableProperty} from '../MutableObservableProperty.shared'

//! Declares com.lightningkite.khrysalis.observables.binding.bind>android.widget.Spinner
export function androidWidgetSpinnerBind<T>(this_: HTMLSelectElement, options: ObservableProperty<Array<T>>, selected: MutableObservableProperty<T>, makeView: (a: ObservableProperty<T>) => HTMLElement): void {
    const observables = options.value.map((x) => {
        return new StandardObservableProperty(x)
    })
    until(subBy(options, undefined, undefined, (options) => {
        //correct number of options
        const diff = options.length - this_.options.length;
        if (diff > 0) {
            for (let i = 0; i < diff; i++) {
                const newOpt = document.createElement("option");
                const newObs = new StandardObservableProperty(options[options.length - 1 - diff + i]);
                makeView(newObs);
                this_.options.add(newOpt);
                observables.push(newObs);
            }
        }
        // else if (diff < 0) {
        //     observables.
        // }
    }), vRemoved(this_));
}

