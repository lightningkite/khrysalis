// Generated by Khrysalis Swift converter - this file will be overwritten.
// File: observables/TransformedMutableObservableProperty.shared.kt
// Package: com.lightningkite.khrysalis.observables
import Foundation

public class TransformedMutableObservableProperty<A, B> : MutableObservableProperty<Any> {
    public var basedOn: MutableObservableProperty<A>
    public var read:  (A) -> B
    public var write:  (B) -> A
    override public init(basedOn: MutableObservableProperty<A>, read: @escaping  (A) -> B, write: @escaping  (B) -> A) {
        self.basedOn = basedOn
        self.read = read
        self.write = write
        self.onChange = self.basedOn.onChange.map(p0: { (it: Any) -> Any in self.read(it) })
        super.init()
    }
    
    override public func update() -> Void {
        self.basedOn.update()
    }
    
    override public var value: B {
        get {
            return self.read(self.basedOn.value)
        }
        set(value) {
            self.basedOn.value = self.write(value)
        }
    }
    override public let onChange: Observable<B>
}


public extension MutableObservableProperty {
    func transformed<B>(read: @escaping  (T) -> B, write: @escaping  (B) -> T) -> MutableObservableProperty<B> {
        return TransformedMutableObservableProperty(basedOn: self, read: read, write: write)
    }
}

public extension MutableObservableProperty {
    func map<B>(read: @escaping  (T) -> B, write: @escaping  (B) -> T) -> MutableObservableProperty<B> {
        return TransformedMutableObservableProperty(basedOn: self, read: read, write: write)
    }
}

