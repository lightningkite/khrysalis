// Generated by Khrysalis Swift converter - this file will be overwritten.
// File: observables/CombineObservableProperty.shared.kt
// Package: com.lightningkite.khrysalis.observables
import RxSwift
import Foundation

public class CombineObservableProperty<T, A, B> : ObservableProperty<T> {
    public var observableA: ObservableProperty<A>
    public var observableB: ObservableProperty<B>
    public var combiner:  (A, B) -> T
    public init(observableA: ObservableProperty<A>, observableB: ObservableProperty<B>, combiner: @escaping  (A, B) -> T) {
        self.observableA = observableA
        self.observableB = observableB
        self.combiner = combiner
        super.init()
        //Necessary properties should be initialized now
    }
    
    override public var value: T {
        get { return self.combiner(self.observableA.value, self.observableB.value) }
    }
    override public var onChange: Observable<T> {
        get {
            let combinerCopy = self.combiner
            return self.observableA.onChange.startWith(self.observableA.value)
                .combineLatest(observable: self.observableB.onChange.startWith(self.observableB.value), function:  { (a: A, b: B) -> T in combinerCopy(a, b) })
                .skip(1)
        }
    }
}

public extension ObservableProperty {
    func combine<B, C>(other: ObservableProperty<B>, combiner: @escaping  (T, B) -> C) -> ObservableProperty<C> {
        return CombineObservableProperty(observableA: self, observableB: other, combiner: combiner)
    }
}


